# ğŸš€ Grok API ç¿»è¯‘æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

åŸºäºä½ çš„ä¸“ä¸š Grok æŒ‡ä»¤å®šåˆ¶çš„ç¿»è¯‘å·¥å…·ï¼Œä¸“é—¨é’ˆå¯¹ Ren'Py æ¸¸æˆæ±‰åŒ–ä¼˜åŒ–ã€‚

## âœ¨ ç‰¹ç‚¹

1. **å®Œæ•´ä¿æŠ¤æœºåˆ¶**
   - âœ… å ä½ç¬¦ä¿æŠ¤ï¼š`[pov]`, `[ls]`, `[bs]`, `[mother]`, `[name]`
   - âœ… Ren'Py æ ‡ç­¾ï¼š`{i}`, `{b}`, `{color=...}`, `{w}`, `{nw}`
   - âœ… æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼š`%(name)s`, `%(n)d`
   - âœ… ç‰¹æ®Šå­—ç¬¦ï¼š`\n`, `\t`

2. **åˆ†æ”¯è¯­æ°”æ§åˆ¶**
   - ğŸ”¥ æˆäººå†…å®¹é£æ ¼ï¼ˆé¸¡å·´ã€å¥¶å­ã€å°ç©´ã€éªšè´§ç­‰ï¼‰
   - ğŸ’• Love è·¯å¾„ï¼šä¿çš®ã€è‡ªç„¶
   - ğŸ˜ˆ Corruptionï¼šå‘½ä»¤ã€å æœ‰
   - ğŸ‘€ Voyeurï¼šæ—è§‚ã€ç©å‘³
   - ğŸ’” NTRï¼šä¸ç”˜ã€è¾ƒåŠ²
   - ğŸ”ª Sadistï¼šå˜²å¼„ã€å‹è¿«

3. **ç§°å‘¼ç³»ç»Ÿï¼ˆinc æ¨¡å¼ï¼‰**
   - `[ls]` â†’ å¦¹å¦¹/å“¥å“¥
   - `[bs]` â†’ å§å§/å¼Ÿå¼Ÿ
   - `[mother]` â†’ å¦ˆå¦ˆ/å„¿å­

## ğŸ’° æˆæœ¬å¯¹æ¯”

| æ¨¡å‹ | ä¸Šä¸‹æ–‡ | è¾“å…¥æˆæœ¬ | è¾“å‡ºæˆæœ¬ | 100ä¸‡å­—æˆæœ¬ |
|------|--------|---------|---------|------------|
| **grok-4-fast-reasoning** | 2M | $0.20/M | $0.50/M | **â‰ˆ $1.20 (Â¥8.5)** â­æ¨è |
| grok-4 | 2M | $3.00/M | $6.00/M | â‰ˆ $18 (Â¥128) |
| grok-3 | 131K | $2.00/M | $10.00/M | â‰ˆ $24 (Â¥170) |

> **100 ä¸‡å­—æ¸¸æˆæ±‰åŒ–åªéœ€ Â¥8.5ï¼**

## ğŸ¯ ä½¿ç”¨æ–¹æ³•

### 1. è·å– API Key

è®¿é—® https://console.x.ai æ³¨å†Œå¹¶åˆ›å»º API Key

### 2. å®‰è£…ä¾èµ–

```bash
pip install rich
```

### 3. ç¿»è¯‘æµç¨‹

#### æ–¹æ³• 1ï¼šä¸€é”®å®Œæ•´æµç¨‹ï¼ˆæ¨èï¼‰âœ…

åœ¨ `menu.ps1` ä¸­é€‰æ‹©ï¼š
```
é€‰é¡¹ 2: âš¡ ä¸€é”®å¿«é€Ÿç¿»è¯‘ï¼ˆäº‘ç«¯ APIï¼‰
â†’ é€‰æ‹© "2. Grok Fast (è¶…å€¼ï¼Œï¿¥1.4/ç™¾ä¸‡Tokenï¼Œ2Mä¸Šä¸‹æ–‡) â­"
â†’ è¾“å…¥ xAI API Key
â†’ ç³»ç»Ÿè‡ªåŠ¨è®¡ç®—æˆæœ¬å¹¶ç¡®è®¤
```

**ç‰¹ç‚¹**ï¼š
- âœ… è‡ªåŠ¨æå– â†’ ç¿»è¯‘ â†’ å›å¡«ï¼Œå…¨ç¨‹è‡ªåŠ¨åŒ–
- âœ… ç¿»è¯‘å‰æ˜¾ç¤ºæˆæœ¬é¢„ä¼°ï¼ˆè¡Œæ•°ã€Tokenã€è´¹ç”¨ï¼‰
- âœ… æ— éœ€æ‰‹åŠ¨åˆ†æ‰¹ï¼Œç›´æ¥å¤„ç†å®Œæ•´ JSONL
- âœ… è‡ªåŠ¨åº”ç”¨ä¸“ä¸šç¿»è¯‘è§„åˆ™ï¼ˆå ä½ç¬¦ä¿æŠ¤ã€è¯­æ°”æ§åˆ¶ï¼‰

#### æ–¹æ³• 2ï¼šå‘½ä»¤è¡Œå•æ–‡ä»¶æ¨¡å¼ï¼ˆé€‚åˆè„šæœ¬é›†æˆï¼‰

```powershell
# 1. æå–æ–‡æœ¬
python tools/extract.py "æ¸¸æˆç›®å½•" -o outputs/extract

# 2. å­—å…¸é¢„å¡«ï¼ˆå¯é€‰ï¼‰
python tools/prefill.py outputs/extract/project_en_for_grok.jsonl `
    data/dictionaries -o outputs/prefilled/prefilled.jsonl

# 3. ä½¿ç”¨ Grok ç›´æ¥ç¿»è¯‘ï¼ˆå•æ–‡ä»¶æ¨¡å¼ï¼‰â­ æ–°åŠŸèƒ½
python tools/translate_grok.py outputs/extract/project_en_for_grok.jsonl `
    -o outputs/results `
    --api-key YOUR_XAI_API_KEY `
    --model grok-4-fast-reasoning

# è¾“å‡º: outputs/results/translated.jsonl

# 4. è´¨é‡æ£€æŸ¥
python tools/validate.py outputs/extract/project_en_for_grok.jsonl `
    outputs/results/translated.jsonl --qa-html outputs/qa/qa.html

# 5. å›å¡«æ¸¸æˆ
python tools/patch.py "æ¸¸æˆç›®å½•" outputs/results/translated.jsonl `
    -o outputs/patched --advanced
```

**ä¼˜ç‚¹**ï¼š
- âœ… çœç•¥åˆ†æ‰¹æ­¥éª¤ï¼ŒGrok 2M ä¸Šä¸‹æ–‡å¯ç›´æ¥å¤„ç†å¤§æ–‡ä»¶
- âœ… è‡ªåŠ¨æ˜¾ç¤º Token ä½¿ç”¨é‡å’Œå®é™…æˆæœ¬
- âœ… æ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼ˆAPI å¤±è´¥è‡ªåŠ¨é‡è¯•ï¼‰

#### æ–¹æ³• 3ï¼šæ‰¹æ¬¡ç›®å½•æ¨¡å¼ï¼ˆé€‚åˆè¶…å¤§é¡¹ç›®ï¼‰

```powershell
# 1-2. æå– + é¢„å¡«ï¼ˆåŒä¸Šï¼‰

# 3. æ‰‹åŠ¨åˆ†æ‰¹ï¼ˆä»…å½“æ–‡ä»¶ > 100MB æˆ– > 50 ä¸‡è¡Œæ—¶ï¼‰
python tools/split.py outputs/extract/project_en_for_grok.jsonl `
    outputs/llm_batches --skip-has-zh --max-tokens 50000

# 4. æ‰¹é‡ç¿»è¯‘ï¼ˆä¼ å…¥ç›®å½•ï¼‰
python tools/translate_grok.py outputs/llm_batches -o outputs/llm_results `
    --api-key YOUR_XAI_API_KEY `
    --model grok-4-fast-reasoning `
    --workers 10 `
    --batch-size 50

# 5. åˆå¹¶ç»“æœ
python tools/merge.py outputs/extract/project_en_for_grok.jsonl `
    outputs/llm_results -o outputs/final/translated.jsonl

# 6-7. éªŒè¯ + å›å¡«ï¼ˆåŒä¸Šï¼‰
```

## âš™ï¸ å‚æ•°è¯´æ˜

### `translate_grok.py` å‚æ•°

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `source` | **è¾“å…¥**ï¼šJSONL æ–‡ä»¶æˆ–æ‰¹æ¬¡ç›®å½• | å¿…å¡« |
| `batches_dir` | æ‰¹æ¬¡ç›®å½• | - |
| `-o, --output` | è¾“å‡ºç›®å½• | - |
| `--api-key` | xAI API Key | - |
| `--model` | æ¨¡å‹åç§° | `grok-4-fast-reasoning` |
| `--workers` | å¹¶å‘æ•° | 5 |
| `--batch-size` | æ¯æ¬¡è¯·æ±‚è¡Œæ•° | 50 |

### æ¨¡å‹é€‰æ‹©å»ºè®®

| åœºæ™¯ | æ¨èæ¨¡å‹ | ç†ç”± |
|------|---------|------|
| **å¤§è§„æ¨¡æ¸¸æˆï¼ˆ100ä¸‡å­—+ï¼‰** | `grok-4-fast-reasoning` | æˆæœ¬ä½ã€é€Ÿåº¦å¿«ã€2M ä¸Šä¸‹æ–‡ |
| è¿½æ±‚æè‡´è´¨é‡ | `grok-4` | æœ€å¼ºæ€§èƒ½ï¼Œä½†è´µ 15 å€ |
| å°é¡¹ç›®æµ‹è¯• | `grok-3` | é€‚åˆå°æ‰¹é‡ |

## ğŸ“Š æ€§èƒ½ä¼°ç®—

### 100 ä¸‡å­—æ¸¸æˆç¤ºä¾‹

```
æ–‡æœ¬é‡: 1,000,000 å­—
Token ä¼°ç®—:
  - è¾“å…¥ (en): ~1,500,000 tokens
  - è¾“å‡º (zh): ~1,800,000 tokens

ä½¿ç”¨ grok-4-fast-reasoning:
  - è¾“å…¥æˆæœ¬: 1.5M Ã— $0.20/M = $0.30
  - è¾“å‡ºæˆæœ¬: 1.8M Ã— $0.50/M = $0.90
  - æ€»æˆæœ¬: $1.20 â‰ˆ Â¥8.5

ç¿»è¯‘æ—¶é—´: çº¦ 30-60 åˆ†é’Ÿï¼ˆå¹¶å‘ 10ï¼‰
```

## ğŸ”§ é«˜çº§æŠ€å·§

### 1. ä¼˜åŒ–å¹¶å‘æ•°

```bash
# GPU æœåŠ¡å™¨å¯ç”¨æ—¶
python tools/translate_grok.py ... --workers 20

# ç½‘ç»œè¾ƒæ…¢æ—¶
python tools/translate_grok.py ... --workers 5
```

### 2. è°ƒæ•´æ‰¹æ¬¡å¤§å°

```bash
# å¤§æ–‡æœ¬ï¼Œå‡å°‘æ‰¹æ¬¡å¤§å°é¿å…è¶…æ—¶
python tools/translate_grok.py ... --batch-size 30

# çŸ­æ–‡æœ¬ï¼Œå¢åŠ æ‰¹æ¬¡å¤§å°æé«˜æ•ˆç‡
python tools/translate_grok.py ... --batch-size 100
```

### 3. æ–­ç‚¹ç»­ä¼ 

å·¥å…·è‡ªåŠ¨æ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼Œä¸­æ–­åé‡æ–°è¿è¡Œä¼šä»ä¸Šæ¬¡ä½ç½®ç»§ç»­ã€‚

### 4. æŸ¥çœ‹å¤±è´¥è®°å½•

```bash
# æŸ¥çœ‹å¤±è´¥çš„ç¿»è¯‘
cat outputs/llm_results/batch_0001_rejects.tsv
```

## ğŸ¨ è¾“å‡ºæ ¼å¼

Grok è¿”å›çš„æ ¼å¼ï¼ˆéµå¾ªä½ çš„æŒ‡ä»¤ï¼‰ï¼š

```jsonl
{"id":"game/script.rpy:10:0","zh":"ä½ é†’äº†ã€‚"}
{"id":"game/script.rpy:11:0","zh":"{i}å—¯ï¼Ÿæˆ‘æ˜¯ä¸æ˜¯å¬åˆ°ä»€ä¹ˆå£°éŸ³ï¼Ÿ{/i}"}
```

å·¥å…·ä¼šè‡ªåŠ¨åˆå¹¶å›åŸå§‹ JSONLï¼š

```jsonl
{"id":"game/script.rpy:10:0","en":"You wake up.","zh":"ä½ é†’äº†ã€‚","file":"game/script.rpy",...}
{"id":"game/script.rpy:11:0","en":"{i}Huh? Did I hear something?{/i}","zh":"{i}å—¯ï¼Ÿæˆ‘æ˜¯ä¸æ˜¯å¬åˆ°ä»€ä¹ˆå£°éŸ³ï¼Ÿ{/i}","file":"game/script.rpy",...}
```

## â“ å¸¸è§é—®é¢˜

### Q: æˆæœ¬ä¼šä¸ä¼šè¶…å‡ºé¢„ç®—ï¼Ÿ

A: å·¥å…·ä¼šåœ¨å¼€å§‹å‰æ˜¾ç¤ºé¢„ä¼°æˆæœ¬ã€‚å¯ä»¥å…ˆç”¨å°æ‰¹æ¬¡æµ‹è¯•ï¼ˆ`--batch-size 10`ï¼‰ã€‚

### Q: ç¿»è¯‘è´¨é‡å¦‚ä½•ï¼Ÿ

A: ä½¿ç”¨ä½ çš„ä¸“ä¸šæŒ‡ä»¤ï¼Œè´¨é‡éå¸¸é«˜ï¼š
- âœ… å®Œæ•´ä¿æŠ¤å ä½ç¬¦å’Œæ ‡ç­¾
- âœ… åˆ†æ”¯è¯­æ°”å‡†ç¡®
- âœ… ç§°å‘¼ç³»ç»Ÿæ­£ç¡®
- âœ… æˆäººå†…å®¹é£æ ¼åˆ°ä½

### Q: é€Ÿåº¦æœ‰å¤šå¿«ï¼Ÿ

A: æ¯”æœ¬åœ° Ollama å¿« 10-20 å€ï¼š
- æœ¬åœ°: ~10 æ¡/åˆ†é’Ÿ
- Grok API: ~100-200 æ¡/åˆ†é’Ÿ

### Q: æ”¯æŒå…¶ä»–è¯­è¨€å—ï¼Ÿ

A: ç›®å‰åªæ”¯æŒè‹±â†’ä¸­ï¼Œä½†å¯ä»¥ä¿®æ”¹ç³»ç»Ÿæç¤ºè¯æ”¯æŒå…¶ä»–è¯­è¨€å¯¹ã€‚

## ğŸ“ æ•…éšœæ’æŸ¥

### API è°ƒç”¨å¤±è´¥

```bash
# æ£€æŸ¥ API Key æ˜¯å¦æ­£ç¡®
curl -H "Authorization: Bearer YOUR_KEY" https://api.x.ai/v1/models

# æ£€æŸ¥ç½‘ç»œè¿æ¥
ping api.x.ai
```

### æ ¼å¼é”™è¯¯

å¦‚æœ Grok è¿”å›æ ¼å¼ä¸å¯¹ï¼Œå·¥å…·ä¼šè‡ªåŠ¨è·³è¿‡å¹¶è®°å½•åˆ° `_rejects.tsv`ã€‚

### è¶…æ—¶

```bash
# å¢åŠ è¶…æ—¶æ—¶é—´ï¼ˆä¿®æ”¹ translate_grok.py ç¬¬ 232 è¡Œï¼‰
timeout: int = 300  # æ”¹ä¸º 300 ç§’
```

## ğŸ‰ æ€»ç»“

**ä¸ºä»€ä¹ˆé€‰æ‹© Grok APIï¼Ÿ**

1. âœ… **è¶…ä½æˆæœ¬**ï¼š100 ä¸‡å­—åªéœ€ Â¥8.5
2. âœ… **ä¸“ä¸šæŒ‡ä»¤**ï¼šåŸºäºä½ çš„ç²¾å¿ƒä¼˜åŒ–çš„ç¿»è¯‘è§„åˆ™
3. âœ… **å¤§ä¸Šä¸‹æ–‡**ï¼š2M tokens å¯å¤„ç†è¶…å¤§æ–‡æœ¬
4. âœ… **é«˜é€Ÿåº¦**ï¼šæ¯”æœ¬åœ°å¿« 10-20 å€
5. âœ… **é«˜è´¨é‡**ï¼šåˆ†æ”¯è¯­æ°”ã€ç§°å‘¼ç³»ç»Ÿã€æˆäººå†…å®¹é£æ ¼å®Œç¾

**ç«‹å³å¼€å§‹ï¼š**
```bash
python tools/translate_grok.py outputs/llm_batches -o outputs/llm_results \
  --api-key YOUR_XAI_API_KEY --model grok-4-fast-reasoning --workers 10
```

ğŸ® ç¥ä½ æ±‰åŒ–æ„‰å¿«ï¼
