# 功能清单 - Ren'Py 汉化工具集

## 📋 通过 ONECLICK.bat 可用的所有功能

运行 `ONECLICK.bat` 后会显示主菜单，包含以下功能：

---

## 🚀 一键流程（推荐）

### 1. 一键自动汉化（Ollama 本地）
**功能：** 完整的本地翻译流程
- ✅ 自动提取游戏文本
- ✅ 生成游戏专用字典
- ✅ 使用本地 Ollama 模型翻译
- ✅ 质量检查
- ✅ 回填翻译并构建游戏

**适用场景：**
- 不想花钱的用户
- 有足够时间等待的用户
- 需要完全离线处理的用户

**预计耗时：** 30-60 分钟（取决于游戏大小）

---

### 2. 一键快速翻译（云端 API）
**功能：** 使用云端 AI 快速翻译
- ✅ 支持 6 种 API：DeepSeek / Grok / OpenAI / Claude
- ✅ 速度最快（2-5 分钟）
- ✅ 质量最好

**支持的 API 提供商：**
- **DeepSeek** (推荐) - ￥1/百万Token
- **Grok** (xAI) - ￥35/百万Token
- **OpenAI GPT-3.5** - ￥7/百万Token
- **OpenAI GPT-4** - ￥70/百万Token
- **Claude Haiku** - ￥3.5/百万Token
- **Claude Sonnet** - ￥21/百万Token

**适用场景：**
- 追求速度和质量的用户
- 愿意支付少量费用的用户
- 需要快速出汉化版的用户

**预计耗时：** 2-5 分钟
**预计成本：** ￥3-50（取决于游戏大小和API选择）

---

### 3. 一键免费机翻（Google/Bing）
**功能：** 使用免费机器翻译
- ✅ 完全免费
- ✅ 无需注册（Google/Bing）
- ✅ 速度较快

**支持的翻译引擎：**
- **Google Translate** (推荐) - 完全免费，速度快
- **Bing Translator** - 完全免费，备选
- **DeepL Free** - 每月50万字符，需注册

**适用场景：**
- 追求零成本的用户
- 只是自己玩不发布的用户
- 对翻译质量要求不高的用户

**预计耗时：** 5-15 分钟
**预计成本：** ￥0（完全免费）

---

## 📦 分步操作

### 4. 提取文本
**功能：** 从游戏中提取所有可翻译文本
- 自动识别 .rpy 脚本文件
- 提取台词、菜单、UI 文本
- 生成 JSONL 格式文件

**输入：** 游戏根目录
**输出：** `outputs/extract/project_en_for_grok.jsonl`

---

### 5. 生成字典
**功能：** 自动生成游戏专用术语字典
- 识别高频词汇
- 分类术语类型（角色名、地点等）
- 生成 CSV 字典文件

**输入：** 提取的 JSONL 文件
**输出：** `data/dictionaries/[游戏名]_dict.csv`

**特点：**
- 自动识别专有名词
- 统计词频并排序
- 可手动编辑字典优化翻译

---

### 6. 翻译文本（选择方案）
**功能：** 选择不同的翻译方案
- Ollama 本地翻译
- 云端 API 翻译
- 免费机器翻译

**提示：** 推荐使用一键流程（选项 1/2/3）

---

### 7. 质量检查
**功能：** 生成翻译质量报告
- 检测占位符错误
- 检测换行符不一致
- 生成 HTML 报告

**输入：** 翻译后的 JSONL 文件
**输出：** `outputs/qa/qa.html`（可在浏览器中打开）

---

### 8. 回填翻译
**功能：** 将翻译结果回填到游戏文件
- 自动备份原文件
- 生成汉化版 .rpy 文件
- 构建可运行的汉化游戏

**输入：** 游戏目录 + 翻译 JSONL
**输出：** `outputs/patched/` 或 `outputs/cn_build/`

---

## 🛠️ 高级功能

### 9. 质量修复工具
**功能：** 检测并修复翻译质量问题

**子功能：**
1. **检测英文残留**
   - 识别译文中的英文单词
   - 生成详细报告
   - 按词汇分组统计

2. **自动修复英文残留**
   - 使用 Ollama 重新翻译问题条目
   - 保留正确的翻译
   - 生成修复报告

**适用场景：**
- 发现翻译中有英文残留
- 机翻质量不理想需要修正
- 发布前的最后质量检查

---

### 10. 翻译统计
**功能：** 查看翻译进度和统计信息
- 总文本数
- 已翻译数
- 未翻译数
- 完成度百分比

**输入：** 翻译 JSONL 文件
**输出：** 控制台显示统计信息

---

### 11. 环境配置
**功能：** 检查开发环境配置

**检查项目：**
- ✓ Python 版本
- ✓ Python 依赖（rich, rapidfuzz 等）
- ✓ Ollama 安装状态
- ✓ 已安装的模型列表
- ✓ GPU 状态（NVIDIA）

**适用场景：**
- 初次使用前的环境检查
- 排查环境问题
- 查看可用模型

---

## 📚 其他可用工具（通过命令行）

虽然不在菜单中，但这些工具也可以通过命令行使用：

### 字典预填 (prefill.py)
```bash
python tools/prefill.py <jsonl> <dict> -o <output>
```

### 分批处理 (split.py)
```bash
python tools/split.py <jsonl> <output_dir> --max-tokens 4000
```

### 合并结果 (merge.py)
```bash
python tools/merge.py <source_jsonl> <result_dir> -o <output>
```

### 验证翻译 (validate.py)
```bash
python tools/validate.py <source> <translated> --qa-html qa.html
```

### 自动修复 (autofix.py)
```bash
python tools/autofix.py <source> <translated> -o <output>
```

### 构建游戏 (build.py)
```bash
python tools/build.py <game_dir> -o <output> --mode mirror --zh-mirror <patched>
```

### 替换字体 (replace_fonts.py)
```bash
python tools/replace_fonts.py <game_dir> --backup
```

---

## 🎯 推荐工作流程

### 方案 A：追求质量（DeepSeek API）
```
1. 运行 ONECLICK.bat
2. 选择 "2" (一键快速翻译 - 云端 API)
3. 选择 DeepSeek
4. 输入 API Key
5. 等待 2-3 分钟
6. 完成！
```

**成本：** ￥3-10
**质量：** ⭐⭐⭐⭐⭐
**速度：** ⚡⚡⚡⚡⚡

---

### 方案 B：完全免费（Google 机翻）
```
1. 运行 ONECLICK.bat
2. 选择 "3" (一键免费机翻)
3. 选择 Google Translate
4. 等待 5-15 分钟
5. 完成！
```

**成本：** ￥0
**质量：** ⭐⭐⭐
**速度：** ⚡⚡⚡⚡

---

### 方案 C：本地处理（Ollama）
```
1. 运行 ONECLICK.bat
2. 选择 "1" (一键自动汉化 - Ollama)
3. 选择模型
4. 等待 30-60 分钟
5. 完成！
```

**成本：** ￥0
**质量：** ⭐⭐⭐
**速度：** ⚡⚡

---

### 方案 D：混合流程（省钱 + 高质量）
```
1. 先用 Google 机翻打底 (选项 3)
2. 使用质量修复工具检测问题 (选项 9)
3. 提取需要重翻的部分
4. 用 DeepSeek API 重翻关键台词
5. 合并结果
```

**成本：** ￥0-2
**质量：** ⭐⭐⭐⭐
**速度：** ⚡⚡⚡

---

## 📝 功能覆盖对照表

| 功能 | ONECLICK.bat | 命令行 | 文档 |
|------|--------------|--------|------|
| 提取文本 | ✅ (选项 4) | ✅ extract.py | ✅ |
| 生成字典 | ✅ (选项 5) | ✅ generate_dict.py | ✅ |
| 字典预填 | ❌ | ✅ prefill.py | ✅ |
| 分批处理 | 🔄 (自动) | ✅ split.py | ✅ |
| Ollama 翻译 | ✅ (选项 1) | ✅ translate.py | ✅ |
| API 翻译 | ✅ (选项 2) | ✅ translate_api.py | ✅ |
| 免费机翻 | ✅ (选项 3) | ✅ translate_free.py | ✅ |
| 合并结果 | 🔄 (自动) | ✅ merge.py | ✅ |
| 质量检查 | ✅ (选项 7) | ✅ validate.py | ✅ |
| 质量修复 | ✅ (选项 9) | ✅ fix_english_leakage.py | ✅ |
| 自动修复 | ❌ | ✅ autofix.py | ✅ |
| 回填翻译 | ✅ (选项 8) | ✅ patch.py | ✅ |
| 构建游戏 | 🔄 (自动) | ✅ build.py | ✅ |
| 替换字体 | 🔄 (自动) | ✅ replace_fonts.py | ✅ |
| 翻译统计 | ✅ (选项 10) | ❌ | - |
| 环境配置 | ✅ (选项 11) | ❌ | - |

**图例：**
- ✅ 直接可用
- 🔄 一键流程中自动执行
- ❌ 不可用（需命令行）

---

## 🆕 新增功能（v2.0）

### API 翻译
- ✅ DeepSeek API 支持
- ✅ Grok (xAI) API 支持
- ✅ OpenAI GPT-4 支持
- ✅ Claude Sonnet 支持

### 免费机翻
- ✅ Google Translate（无需注册）
- ✅ Bing Translator（无需注册）
- ✅ DeepL Free（需注册）

### 质量工具
- ✅ 英文残留检测
- ✅ 自动修复功能
- ✅ 质量报告生成

### 菜单系统
- ✅ 交互式主菜单
- ✅ 一键流程集成
- ✅ 分步操作支持

---

## 💡 使用建议

1. **新手用户：** 直接使用一键流程（选项 1/2/3）
2. **高级用户：** 使用分步操作定制流程
3. **追求质量：** DeepSeek API（选项 2）
4. **追求免费：** Google 机翻（选项 3）
5. **完全离线：** Ollama 本地（选项 1）

---

## 📞 获取帮助

- 详细文档：`docs/` 目录
- API 翻译指南：`docs/API_TRANSLATION_GUIDE.md`
- 快速开始：`docs/quickstart.md`
- 用户手册：`docs/USER_GUIDE.md`

---

## 🔄 更新日志

### 2025-11-10 (v2.0)
- ✅ 添加交互式菜单系统
- ✅ 集成 6 种云端 API 翻译
- ✅ 添加 3 种免费机器翻译
- ✅ 简化非对话过滤功能
- ✅ 优化翻译质量检测
- ✅ 完善文档和示例

---

**总结：所有核心功能都可以通过 ONECLICK.bat 使用！**
